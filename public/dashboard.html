<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Knowledge Extractor - ç®¡ç†ä»ªè¡¨æ¿</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        /* é¡¶éƒ¨å¯¼èˆª */
        .header {
            background: white;
            border-radius: 12px;
            padding: 20px 30px;
            margin-bottom: 30px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header h1 {
            color: #333;
            font-size: 28px;
        }

        .header-nav {
            display: flex;
            gap: 20px;
        }

        .nav-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s;
        }

        .nav-btn.active {
            background: #667eea;
            color: white;
        }

        .nav-btn:not(.active) {
            background: #f0f0f0;
            color: #333;
        }

        .nav-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        /* ç»Ÿè®¡å¡ç‰‡ */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            text-align: center;
        }

        .stat-card h3 {
            color: #666;
            font-size: 14px;
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .stat-card .number {
            font-size: 36px;
            font-weight: bold;
            color: #667eea;
        }

        .stat-card .subtitle {
            color: #999;
            font-size: 12px;
            margin-top: 10px;
        }

        /* ä¸»å†…å®¹åŒºåŸŸ */
        .content {
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        }

        .content h2 {
            color: #333;
            margin-bottom: 20px;
            font-size: 20px;
        }

        /* è¡¨æ ¼ */
        .table-container {
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        thead {
            background: #f8f9fa;
            border-bottom: 2px solid #e9ecef;
        }

        th {
            padding: 15px;
            text-align: left;
            color: #666;
            font-weight: 600;
            font-size: 14px;
        }

        td {
            padding: 15px;
            border-bottom: 1px solid #e9ecef;
            color: #333;
            font-size: 14px;
        }

        tr:hover {
            background: #f8f9fa;
        }

        /* çŠ¶æ€æ ‡ç­¾ */
        .status-badge {
            display: inline-block;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }

        .status-completed {
            background: #d4edda;
            color: #155724;
        }

        .status-processing {
            background: #fff3cd;
            color: #856404;
        }

        .status-failed {
            background: #f8d7da;
            color: #721c24;
        }

        /* æ“ä½œæŒ‰é’® */
        .action-btn {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 600;
            transition: all 0.3s;
            margin-right: 8px;
        }

        .btn-view {
            background: #667eea;
            color: white;
        }

        .btn-view:hover {
            background: #5568d3;
        }

        .btn-delete {
            background: #f8d7da;
            color: #721c24;
        }

        .btn-delete:hover {
            background: #f5c6cb;
        }

        .btn-export {
            background: #d1ecf1;
            color: #0c5460;
        }

        .btn-export:hover {
            background: #bee5eb;
        }

        /* æœç´¢å’Œç­›é€‰ */
        .filters {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .search-box {
            flex: 1;
            min-width: 200px;
        }

        .search-box input {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            font-size: 14px;
        }

        .search-box input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .filter-select {
            padding: 12px 15px;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            font-size: 14px;
            background: white;
            cursor: pointer;
        }

        .filter-select:focus {
            outline: none;
            border-color: #667eea;
        }

        /* è¯¦æƒ…æ¨¡æ€æ¡† */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 12px;
            padding: 30px;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            border-bottom: 1px solid #e9ecef;
            padding-bottom: 15px;
        }

        .modal-header h2 {
            color: #333;
            font-size: 20px;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 28px;
            cursor: pointer;
            color: #999;
        }

        .close-btn:hover {
            color: #333;
        }

        .detail-section {
            margin-bottom: 20px;
        }

        .detail-section h3 {
            color: #667eea;
            font-size: 14px;
            margin-bottom: 10px;
            text-transform: uppercase;
            font-weight: 600;
        }

        .detail-content {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            color: #333;
            line-height: 1.6;
            word-break: break-word;
        }

        .knowledge-item {
            background: white;
            border-left: 4px solid #667eea;
            padding: 12px;
            margin-bottom: 10px;
            border-radius: 4px;
        }

        .knowledge-item strong {
            color: #667eea;
        }

        /* ç©ºçŠ¶æ€ */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #999;
        }

        .empty-state-icon {
            font-size: 48px;
            margin-bottom: 20px;
        }

        .empty-state h3 {
            color: #666;
            margin-bottom: 10px;
        }

        /* åŠ è½½åŠ¨ç”» */
        .loading {
            text-align: center;
            padding: 40px;
        }

        .spinner {
            display: inline-block;
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* å“åº”å¼ */
        @media (max-width: 768px) {
            .header {
                flex-direction: column;
                gap: 15px;
            }

            .header-nav {
                width: 100%;
                justify-content: space-between;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .filters {
                flex-direction: column;
            }

            .search-box {
                min-width: auto;
            }

            table {
                font-size: 12px;
            }

            th, td {
                padding: 10px;
            }

            .action-btn {
                padding: 6px 10px;
                font-size: 11px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- é¡¶éƒ¨å¯¼èˆª -->
        <div class="header">
            <h1>ğŸ“š Knowledge Extractor</h1>
            <div class="header-nav">
                <button class="nav-btn active" onclick="switchTab('dashboard')">ä»ªè¡¨æ¿</button>
                <button class="nav-btn" onclick="switchTab('documents')">æ–‡æ¡£</button>
                <button class="nav-btn" onclick="switchTab('links')">é“¾æ¥</button>
                <button class="nav-btn" onclick="switchTab('knowledge')">çŸ¥è¯†ç‚¹</button>
            </div>
        </div>

        <!-- ç»Ÿè®¡å¡ç‰‡ -->
        <div class="stats-grid" id="statsGrid">
            <div class="stat-card">
                <h3>æ€»æ–‡æ¡£æ•°</h3>
                <div class="number" id="totalDocs">0</div>
                <div class="subtitle">å·²ä¸Šä¼ </div>
            </div>
            <div class="stat-card">
                <h3>æ€»é“¾æ¥æ•°</h3>
                <div class="number" id="totalLinks">0</div>
                <div class="subtitle">å·²æäº¤</div>
            </div>
            <div class="stat-card">
                <h3>çŸ¥è¯†ç‚¹æ•°</h3>
                <div class="number" id="totalKnowledge">0</div>
                <div class="subtitle">å·²æå–</div>
            </div>
            <div class="stat-card">
                <h3>å¤„ç†æˆåŠŸç‡</h3>
                <div class="number" id="successRate">0%</div>
                <div class="subtitle">å·²å®Œæˆ</div>
            </div>
        </div>

        <!-- ä¸»å†…å®¹åŒºåŸŸ -->
        <div class="content">
            <!-- ä»ªè¡¨æ¿æ ‡ç­¾é¡µ -->
            <div id="dashboard-tab" class="tab-content">
                <h2>ğŸ“Š å¤„ç†ç»Ÿè®¡</h2>
                <div class="filters">
                    <div class="search-box">
                        <input type="text" id="searchInput" placeholder="æœç´¢æ–‡æ¡£æˆ–é“¾æ¥..." onkeyup="filterItems()">
                    </div>
                    <select class="filter-select" id="typeFilter" onchange="filterItems()">
                        <option value="">æ‰€æœ‰ç±»å‹</option>
                        <option value="document">æ–‡æ¡£</option>
                        <option value="link">é“¾æ¥</option>
                    </select>
                    <select class="filter-select" id="statusFilter" onchange="filterItems()">
                        <option value="">æ‰€æœ‰çŠ¶æ€</option>
                        <option value="completed">å·²å®Œæˆ</option>
                        <option value="processing">å¤„ç†ä¸­</option>
                        <option value="failed">å¤±è´¥</option>
                    </select>
                </div>
                <div id="recentItems"></div>
            </div>

            <!-- æ–‡æ¡£æ ‡ç­¾é¡µ -->
            <div id="documents-tab" class="tab-content" style="display: none;">
                <h2>ğŸ“„ ä¸Šä¼ çš„æ–‡æ¡£</h2>
                <div class="filters">
                    <div class="search-box">
                        <input type="text" id="docSearch" placeholder="æœç´¢æ–‡æ¡£..." onkeyup="filterDocuments()">
                    </div>
                </div>
                <div id="documentsTable"></div>
            </div>

            <!-- é“¾æ¥æ ‡ç­¾é¡µ -->
            <div id="links-tab" class="tab-content" style="display: none;">
                <h2>ğŸ”— æäº¤çš„é“¾æ¥</h2>
                <div class="filters">
                    <div class="search-box">
                        <input type="text" id="linkSearch" placeholder="æœç´¢é“¾æ¥..." onkeyup="filterLinks()">
                    </div>
                </div>
                <div id="linksTable"></div>
            </div>

            <!-- çŸ¥è¯†ç‚¹æ ‡ç­¾é¡µ -->
            <div id="knowledge-tab" class="tab-content" style="display: none;">
                <h2>ğŸ’¡ æå–çš„çŸ¥è¯†ç‚¹</h2>
                <div class="filters">
                    <div class="search-box">
                        <input type="text" id="knowledgeSearch" placeholder="æœç´¢çŸ¥è¯†ç‚¹..." onkeyup="filterKnowledge()">
                    </div>
                    <button class="action-btn btn-export" onclick="exportKnowledge()">ğŸ“¥ å¯¼å‡ºæ‰€æœ‰</button>
                </div>
                <div id="knowledgeList"></div>
            </div>
        </div>
    </div>

    <!-- è¯¦æƒ…æ¨¡æ€æ¡† -->
    <div class="modal" id="detailModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalTitle">è¯¦æƒ…</h2>
                <button class="close-btn" onclick="closeModal()">&times;</button>
            </div>
            <div id="modalBody"></div>
        </div>
    </div>

    <script>
        let allDocuments = [];
        let allLinks = [];
        let allKnowledge = [];

        // åˆå§‹åŒ–
        async function init() {
            await loadDocuments();
            await loadLinks();
            await loadKnowledge();
            updateStats();
            renderDashboard();
        }

        // åŠ è½½æ–‡æ¡£
        async function loadDocuments() {
            try {
                const response = await fetch('/api/documents');
                const data = await response.json();
                allDocuments = data.data || [];
            } catch (error) {
                console.error('Error loading documents:', error);
            }
        }

        // åŠ è½½é“¾æ¥
        async function loadLinks() {
            try {
                const response = await fetch('/api/links');
                const data = await response.json();
                allLinks = data.data || [];
            } catch (error) {
                console.error('Error loading links:', error);
            }
        }

        // åŠ è½½çŸ¥è¯†ç‚¹
        async function loadKnowledge() {
            try {
                const response = await fetch('/api/knowledge-points');
                const data = await response.json();
                allKnowledge = data.data || [];
            } catch (error) {
                console.error('Error loading knowledge:', error);
            }
        }

        // æ›´æ–°ç»Ÿè®¡
        function updateStats() {
            document.getElementById('totalDocs').textContent = allDocuments.length;
            document.getElementById('totalLinks').textContent = allLinks.length;
            document.getElementById('totalKnowledge').textContent = allKnowledge.length;

            const completed = allDocuments.filter(d => d.status === 'completed').length + 
                            allLinks.filter(l => l.status === 'completed').length;
            const total = allDocuments.length + allLinks.length;
            const rate = total > 0 ? Math.round((completed / total) * 100) : 0;
            document.getElementById('successRate').textContent = rate + '%';
        }

        // åˆ‡æ¢æ ‡ç­¾é¡µ
        function switchTab(tab) {
            // éšè—æ‰€æœ‰æ ‡ç­¾é¡µ
            document.querySelectorAll('.tab-content').forEach(el => el.style.display = 'none');
            document.querySelectorAll('.nav-btn').forEach(el => el.classList.remove('active'));

            // æ˜¾ç¤ºé€‰ä¸­çš„æ ‡ç­¾é¡µ
            document.getElementById(tab + '-tab').style.display = 'block';
            event.target.classList.add('active');

            // æ¸²æŸ“å†…å®¹
            if (tab === 'documents') renderDocuments();
            else if (tab === 'links') renderLinks();
            else if (tab === 'knowledge') renderKnowledge();
            else renderDashboard();
        }

        // æ¸²æŸ“ä»ªè¡¨æ¿
        function renderDashboard() {
            const items = [...allDocuments, ...allLinks].sort((a, b) => 
                new Date(b.updatedAt) - new Date(a.updatedAt)
            ).slice(0, 10);

            if (items.length === 0) {
                document.getElementById('recentItems').innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">ğŸ“­</div>
                        <h3>æš‚æ— æ•°æ®</h3>
                        <p>ä¸Šä¼ æ–‡æ¡£æˆ–æäº¤é“¾æ¥åï¼Œå¤„ç†ç»“æœå°†æ˜¾ç¤ºåœ¨è¿™é‡Œ</p>
                    </div>
                `;
                return;
            }

            let html = '<div class="table-container"><table><thead><tr><th>æ ‡é¢˜</th><th>ç±»å‹</th><th>çŠ¶æ€</th><th>æ—¶é—´</th><th>æ“ä½œ</th></tr></thead><tbody>';
            
            items.forEach(item => {
                const type = item.fileName ? 'æ–‡æ¡£' : 'é“¾æ¥';
                const status = getStatusBadge(item.status);
                const date = new Date(item.updatedAt).toLocaleString('zh-CN');
                html += `
                    <tr>
                        <td>${item.title || item.url}</td>
                        <td>${type}</td>
                        <td>${status}</td>
                        <td>${date}</td>
                        <td>
                            <button class="action-btn btn-view" onclick="showDetail('${item.id}', '${type}')">æŸ¥çœ‹</button>
                        </td>
                    </tr>
                `;
            });

            html += '</tbody></table></div>';
            document.getElementById('recentItems').innerHTML = html;
        }

        // æ¸²æŸ“æ–‡æ¡£åˆ—è¡¨
        function renderDocuments() {
            if (allDocuments.length === 0) {
                document.getElementById('documentsTable').innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">ğŸ“„</div>
                        <h3>æš‚æ— æ–‡æ¡£</h3>
                        <p>ä¸Šä¼ PDFæˆ–å…¶ä»–æ–‡æ¡£åï¼Œå°†æ˜¾ç¤ºåœ¨è¿™é‡Œ</p>
                    </div>
                `;
                return;
            }

            let html = '<div class="table-container"><table><thead><tr><th>æ–‡ä»¶å</th><th>å¤§å°</th><th>çŠ¶æ€</th><th>çŸ¥è¯†ç‚¹</th><th>ä¸Šä¼ æ—¶é—´</th><th>æ“ä½œ</th></tr></thead><tbody>';
            
            allDocuments.forEach(doc => {
                const status = getStatusBadge(doc.status);
                const size = (doc.fileSize / 1024).toFixed(2) + ' KB';
                const date = new Date(doc.createdAt).toLocaleString('zh-CN');
                const knowledge = doc.extractedKnowledge ? doc.extractedKnowledge.total || 0 : 0;
                html += `
                    <tr>
                        <td>${doc.fileName}</td>
                        <td>${size}</td>
                        <td>${status}</td>
                        <td>${knowledge}</td>
                        <td>${date}</td>
                        <td>
                            <button class="action-btn btn-view" onclick="showDetail('${doc.id}', 'æ–‡æ¡£')">æŸ¥çœ‹</button>
                            <button class="action-btn btn-delete" onclick="deleteItem('${doc.id}', 'document')">åˆ é™¤</button>
                        </td>
                    </tr>
                `;
            });

            html += '</tbody></table></div>';
            document.getElementById('documentsTable').innerHTML = html;
        }

        // æ¸²æŸ“é“¾æ¥åˆ—è¡¨
        function renderLinks() {
            if (allLinks.length === 0) {
                document.getElementById('linksTable').innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">ğŸ”—</div>
                        <h3>æš‚æ— é“¾æ¥</h3>
                        <p>æäº¤é“¾æ¥åï¼Œå°†æ˜¾ç¤ºåœ¨è¿™é‡Œ</p>
                    </div>
                `;
                return;
            }

            let html = '<div class="table-container"><table><thead><tr><th>æ ‡é¢˜</th><th>URL</th><th>ç±»å‹</th><th>çŠ¶æ€</th><th>æäº¤æ—¶é—´</th><th>æ“ä½œ</th></tr></thead><tbody>';
            
            allLinks.forEach(link => {
                const status = getStatusBadge(link.status);
                const date = new Date(link.createdAt).toLocaleString('zh-CN');
                const url = link.url.length > 50 ? link.url.substring(0, 50) + '...' : link.url;
                html += `
                    <tr>
                        <td>${link.title}</td>
                        <td title="${link.url}">${url}</td>
                        <td>${link.contentType || '-'}</td>
                        <td>${status}</td>
                        <td>${date}</td>
                        <td>
                            <button class="action-btn btn-view" onclick="showDetail('${link.id}', 'é“¾æ¥')">æŸ¥çœ‹</button>
                            <button class="action-btn btn-delete" onclick="deleteItem('${link.id}', 'link')">åˆ é™¤</button>
                        </td>
                    </tr>
                `;
            });

            html += '</tbody></table></div>';
            document.getElementById('linksTable').innerHTML = html;
        }

        // æ¸²æŸ“çŸ¥è¯†ç‚¹åˆ—è¡¨
        function renderKnowledge() {
            if (allKnowledge.length === 0) {
                document.getElementById('knowledgeList').innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">ğŸ’¡</div>
                        <h3>æš‚æ— çŸ¥è¯†ç‚¹</h3>
                        <p>å¤„ç†æ–‡æ¡£æˆ–é“¾æ¥åï¼ŒçŸ¥è¯†ç‚¹å°†æ˜¾ç¤ºåœ¨è¿™é‡Œ</p>
                    </div>
                `;
                return;
            }

            let html = '';
            allKnowledge.forEach(kp => {
                const methods = Array.isArray(kp.methods) ? kp.methods.join(' | ') : kp.methods;
                html += `
                    <div class="knowledge-item">
                        <strong>é—®é¢˜:</strong> ${kp.problem}<br>
                        <strong>æ–¹æ³•:</strong> ${methods}
                    </div>
                `;
            });

            document.getElementById('knowledgeList').innerHTML = html;
        }

        // è·å–çŠ¶æ€å¾½ç« 
        function getStatusBadge(status) {
            const badges = {
                'completed': '<span class="status-badge status-completed">âœ“ å·²å®Œæˆ</span>',
                'processing': '<span class="status-badge status-processing">â³ å¤„ç†ä¸­</span>',
                'failed': '<span class="status-badge status-failed">âœ— å¤±è´¥</span>'
            };
            return badges[status] || status;
        }

        // æ˜¾ç¤ºè¯¦æƒ…
        async function showDetail(id, type) {
            const item = type === 'æ–‡æ¡£' ? 
                allDocuments.find(d => d.id === id) : 
                allLinks.find(l => l.id === id);

            if (!item) return;

            let html = `
                <div class="detail-section">
                    <h3>åŸºæœ¬ä¿¡æ¯</h3>
                    <div class="detail-content">
                        <strong>æ ‡é¢˜:</strong> ${item.title || item.fileName}<br>
                        <strong>ç±»å‹:</strong> ${type}<br>
                        <strong>çŠ¶æ€:</strong> ${item.status}<br>
                        <strong>åˆ›å»ºæ—¶é—´:</strong> ${new Date(item.createdAt).toLocaleString('zh-CN')}<br>
                        ${item.url ? `<strong>URL:</strong> <a href="${item.url}" target="_blank">${item.url}</a><br>` : ''}
                        ${item.fileSize ? `<strong>æ–‡ä»¶å¤§å°:</strong> ${(item.fileSize / 1024).toFixed(2)} KB<br>` : ''}
                    </div>
                </div>
            `;

            if (item.description) {
                html += `
                    <div class="detail-section">
                        <h3>æè¿°</h3>
                        <div class="detail-content">${item.description}</div>
                    </div>
                `;
            }

            if (item.content) {
                const content = item.content.substring(0, 500);
                html += `
                    <div class="detail-section">
                        <h3>å†…å®¹é¢„è§ˆ</h3>
                        <div class="detail-content">${content}${item.content.length > 500 ? '...' : ''}</div>
                    </div>
                `;
            }

            if (item.llmAnalysis) {
                html += `
                    <div class="detail-section">
                        <h3>LLMåˆ†æç»“æœ</h3>
                        <div class="detail-content">
                            <strong>æ‘˜è¦:</strong> ${item.llmAnalysis.summary}<br>
                            <strong>å…³é”®ç‚¹:</strong> ${(item.llmAnalysis.keyPoints || []).join(', ')}<br>
                            <strong>æ ‡ç­¾:</strong> ${(item.llmAnalysis.tags || []).join(', ')}<br>
                            <strong>éš¾åº¦:</strong> ${item.llmAnalysis.difficulty}
                        </div>
                    </div>
                `;
            }

            if (item.extractedKnowledge && item.extractedKnowledge.deduplicationResult) {
                const result = item.extractedKnowledge.deduplicationResult;
                html += `
                    <div class="detail-section">
                        <h3>çŸ¥è¯†ç‚¹æå–ç»“æœ</h3>
                        <div class="detail-content">
                            <strong>æ–°çŸ¥è¯†ç‚¹:</strong> ${result.new.length}<br>
                            <strong>ç›¸åŒçŸ¥è¯†ç‚¹:</strong> ${result.identical.length}<br>
                            <strong>ç›¸ä¼¼çŸ¥è¯†ç‚¹:</strong> ${result.similar.length}
                        </div>
                    </div>
                `;
            }

            document.getElementById('modalTitle').textContent = item.title || item.fileName;
            document.getElementById('modalBody').innerHTML = html;
            document.getElementById('detailModal').classList.add('active');
        }

        // å…³é—­æ¨¡æ€æ¡†
        function closeModal() {
            document.getElementById('detailModal').classList.remove('active');
        }

        // åˆ é™¤é¡¹ç›®
        async function deleteItem(id, type) {
            if (!confirm('ç¡®å®šè¦åˆ é™¤å—ï¼Ÿ')) return;

            try {
                const endpoint = type === 'document' ? `/api/documents/${id}` : `/api/links/${id}`;
                const response = await fetch(endpoint, { method: 'DELETE' });
                
                if (response.ok) {
                    alert('åˆ é™¤æˆåŠŸ');
                    if (type === 'document') {
                        allDocuments = allDocuments.filter(d => d.id !== id);
                        renderDocuments();
                    } else {
                        allLinks = allLinks.filter(l => l.id !== id);
                        renderLinks();
                    }
                    updateStats();
                }
            } catch (error) {
                console.error('Error deleting item:', error);
                alert('åˆ é™¤å¤±è´¥');
            }
        }

        // å¯¼å‡ºçŸ¥è¯†ç‚¹
        function exportKnowledge() {
            const csv = 'Problem,Methods\n' + allKnowledge.map(kp => 
                `"${kp.problem}","${Array.isArray(kp.methods) ? kp.methods.join('; ') : kp.methods}"`
            ).join('\n');

            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `knowledge_points_${new Date().toISOString().split('T')[0]}.csv`;
            link.click();
        }

        // ç­›é€‰å‡½æ•°
        function filterItems() {
            const search = document.getElementById('searchInput').value.toLowerCase();
            const type = document.getElementById('typeFilter').value;
            const status = document.getElementById('statusFilter').value;

            const items = [...allDocuments, ...allLinks].filter(item => {
                const matchSearch = !search || 
                    (item.title && item.title.toLowerCase().includes(search)) ||
                    (item.fileName && item.fileName.toLowerCase().includes(search)) ||
                    (item.url && item.url.toLowerCase().includes(search));
                
                const matchType = !type || 
                    (type === 'document' && item.fileName) ||
                    (type === 'link' && item.url);
                
                const matchStatus = !status || item.status === status;

                return matchSearch && matchType && matchStatus;
            });

            renderFilteredItems(items);
        }

        function filterDocuments() {
            const search = document.getElementById('docSearch').value.toLowerCase();
            const filtered = allDocuments.filter(doc => 
                !search || doc.fileName.toLowerCase().includes(search) || 
                (doc.title && doc.title.toLowerCase().includes(search))
            );
            renderFilteredDocuments(filtered);
        }

        function filterLinks() {
            const search = document.getElementById('linkSearch').value.toLowerCase();
            const filtered = allLinks.filter(link => 
                !search || link.url.toLowerCase().includes(search) || 
                (link.title && link.title.toLowerCase().includes(search))
            );
            renderFilteredLinks(filtered);
        }

        function filterKnowledge() {
            const search = document.getElementById('knowledgeSearch').value.toLowerCase();
            const filtered = allKnowledge.filter(kp => 
                !search || kp.problem.toLowerCase().includes(search) ||
                (Array.isArray(kp.methods) ? kp.methods.join(' ').toLowerCase().includes(search) : 
                    kp.methods.toLowerCase().includes(search))
            );
            renderFilteredKnowledge(filtered);
        }

        function renderFilteredItems(items) {
            if (items.length === 0) {
                document.getElementById('recentItems').innerHTML = '<div class="empty-state"><p>æœªæ‰¾åˆ°åŒ¹é…çš„é¡¹ç›®</p></div>';
                return;
            }
            // é‡æ–°æ¸²æŸ“...
        }

        function renderFilteredDocuments(docs) {
            // ç±»ä¼¼çš„å®ç°...
        }

        function renderFilteredLinks(links) {
            // ç±»ä¼¼çš„å®ç°...
        }

        function renderFilteredKnowledge(knowledge) {
            let html = '';
            knowledge.forEach(kp => {
                const methods = Array.isArray(kp.methods) ? kp.methods.join(' | ') : kp.methods;
                html += `
                    <div class="knowledge-item">
                        <strong>é—®é¢˜:</strong> ${kp.problem}<br>
                        <strong>æ–¹æ³•:</strong> ${methods}
                    </div>
                `;
            });
            document.getElementById('knowledgeList').innerHTML = html || '<div class="empty-state"><p>æœªæ‰¾åˆ°åŒ¹é…çš„çŸ¥è¯†ç‚¹</p></div>';
        }

        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        window.addEventListener('load', init);

        // å®šæœŸåˆ·æ–°æ•°æ®
        setInterval(async () => {
            await loadDocuments();
            await loadLinks();
            await loadKnowledge();
            updateStats();
        }, 30000); // æ¯30ç§’åˆ·æ–°ä¸€æ¬¡
    </script>
</body>
</html>
